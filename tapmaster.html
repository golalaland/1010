<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Tap Master</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0e0e0e;
  --glass-bg: rgba(255,255,255,0.04);
  --accent1:#FF1493;
  --accent2:#FF8C00;
  --green1:#00e676;
  --muted:#aaa;
  --glass-border: rgba(255,255,255,0.08);
}
  
*{box-sizing:border-box}
html,body {height:100%;margin:0;background:var(--bg);color:#fff;font-family:'Montserrat',sans-serif; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body {display:flex;justify-content:center;align-items:flex-start;padding:18px 0 120px; touch-action:manipulation; -webkit-tap-highlight-color: transparent; overflow-x:hidden;}
#appWrapper {width:100%;max-width:480px;display:flex;flex-direction:column;align-items:center;}

/* header */
#gameHeader{text-align:center;margin-top:6px;}
#welcomeText{font-family:'Press Start 2P',cursive;font-size:11px;color:var(--accent1)}
#scrambleText{font-family:'Press Start 2P',cursive;font-size:20px;color:var(--accent1);margin-top:4px}

/* glass terminal (tap stats + timer etc) */
.glass-terminal {
  width: 90%;
  max-width: 420px;
  margin: 18px auto;
  padding: 14px 16px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  color: #fff;
  position: relative;
  overflow: hidden;
}
.terminal-header { text-align:center; color:var(--accent1); font-size:11px; letter-spacing:2px; margin-bottom:8px; font-weight:700; }
.terminal-line { font-size:13px; line-height:1.6; letter-spacing:1px; color:#fff; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center; }
.terminal-line span { color:#00FF99; text-shadow:0 0 6px rgba(0,255,153,0.08); font-weight:700; }

/* train bar (timer visual) */
#trainBarContainer {
  width:100%;
  height:14px;
  background: rgba(255,255,255,0.03);
  border-radius: 999px;
  overflow:hidden;
  margin-top:8px;
}
#trainBar {
  height:100%;
  width:100%;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  transform-origin: left center;
  transition: width 0.2s linear;
}

/* stats row inside terminal */
.stats-row { display:flex; justify-content:space-between; gap:12px; margin-top:8px; align-items:center; }
.stat { flex:1; background: rgba(255,255,255,0.02); padding:8px; border-radius:8px; text-align:center; }
.stat .label { font-size:11px; color:var(--muted); }
.stat .value { font-size:16px; font-weight:800; color:#fff; }

/* bonus bar (progress toward next bonus level) */
#bonusContainer { width:100%; height:10px; background:#111; border-radius:999px; overflow:hidden; margin-top:12px; box-shadow:0 6px 16px rgba(0,0,0,0.6) inset; }
#bonusBar { height:100%; width:0%; background:linear-gradient(90deg,var(--green1),#00b0ff); transition:width .15s linear; }

/* -------------------------------------------------
   3D Gem Tap Button ‚Äì unique, addictive, mobile-ready
   ------------------------------------------------- */
#tapButton {
  --gem: #00e676;          /* main gem color */
  --glow: #00ffd0;         /* glow highlight */
  --shadow: rgba(0,230,118,.35);
  --pulse: 1.5s;

  position: relative;
  width: 84px; height: 84px;          /* a bit larger for 3D feel */
  border: none;
  border-radius: 50%;
  background: radial-gradient(
    circle at 30% 30%,
    #fff    0%,
    var(--gem) 30%,
    #008b47 100%
  );
  box-shadow:
    0 8px 20px var(--shadow),
    inset 0 -4px 8px rgba(0,0,0,.2),
    inset 0 4px 8px rgba(255,255,255,.4);
  cursor: pointer;
  overflow: hidden;
  transition: transform .08s ease-out;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

/* Inner text ‚Äì slightly lifted for depth */
#tapButton .inner {
  position: relative;
  z-index: 2;
  font: 800 20px/1 "Arial", sans-serif;
  color: #000;
  text-shadow: 0 1px 1px rgba(255,255,255,.6);
}

/* Hover / Ready pulse (desktop) */
#tapButton::before {
  content: "";
  position: absolute;
  inset: -10px;
  border-radius: 50%;
  background: radial-gradient(circle, transparent 60%, var(--glow) 100%);
  opacity: 0;
  animation: pulse var(--pulse) infinite ease-out;
  pointer-events: none;
}
#tapButton:hover::before { opacity: .4; }

/* Mobile ‚Äúready‚Äù glow (no hover) */
@media (hover: none) {
  #tapButton::before { animation: pulse-mobile var(--pulse) infinite ease-out; }
}

/* 3D press animation */
#tapButton:active {
  transform: translateY(4px) scale(.94);
  box-shadow:
    0 4px 10px var(--shadow),
    inset 0 -2px 4px rgba(0,0,0,.2),
    inset 0 2px 4px rgba(255,255,255,.4);
}

/* Ripple effect */
#tapButton .ripple {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,255,255,.6) 10%, transparent 70%);
  transform: scale(0);
  animation: ripple .6s ease-out;
  pointer-events: none;
}
#tapButton:active .ripple {
  inset: 0;
}

/* -------------------------------------------------
   Keyframes
   ------------------------------------------------- */
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 0; }
  50%      { transform: scale(1.3); opacity: .4; }
}
@keyframes pulse-mobile {
  0%, 100% { opacity: .15; }
  50%      { opacity: .35; }
}
@keyframes ripple {
  to { transform: scale(4); opacity: 0; }
}

/* Optional: tiny particle burst on tap (pure CSS) */
#tapButton:active::after {
  content: "";
  position: absolute;
  inset: 50%;
  width: 6px; height: 6px;
  margin: -3px;
  background: var(--glow);
  border-radius: 50%;
  box-shadow:
    0 0 8px 2px var(--glow),
    20px -20px 0 -2px var(--glow),
    -20px 20px 0 -2px var(--glow),
    20px 20px 0 -2px var(--glow),
    -20px -20px 0 -2px var(--glow);
  animation: burst .4s ease-out forwards;
}
@keyframes burst {
  to { transform: translateY(-30px); opacity: 0; }
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 4 DOPE CONFETTI STYLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.confetti-dot {
  position: absolute;
  width: 6px; height: 6px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  opacity: 1;
}

/* 1. Classic rainbow */
.confetti-rainbow { background: hsl(var(--h),80%,60%); }
@keyframes rainbowFall {
  to { transform: translate(var(--dx), var(--dy)) rotate(720deg); opacity:0; }
}

/* 2. Neon spark */
.confetti-spark { background:#0ff; box-shadow:0 0 6px #0ff; }
@keyframes sparkBurst {
  to { transform: translate(var(--dx), var(--dy)) scale(0); opacity:0; }
}

/* 3. Gold coin */
.confetti-coin { background:#ff0; border-radius:0; width:8px; height:4px; }
@keyframes coinFlip {
  to { transform: translate(var(--dx), var(--dy)) rotateY(720deg); opacity:0; }
}

/* 4. Firework star */
.confetti-star {
  background: transparent;
  width:0; height:0;
  border-left: 4px solid transparent;
  border-right:4px solid transparent;
  border-bottom:8px solid #ff0;
}
@keyframes starBoom {
  to { transform: translate(var(--dx), var(--dy)) rotate(360deg) scale(2); opacity:0; }
}
/* modal (normal fade-in centered) */
  .modal-backdrop {
    position:fixed; inset:0; background: rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:9999;
  }
  .modal {
  width:92%; max-width:420px; background:#0f0f0f; border-radius:12px; padding:16px; border:1px solid rgba(255,255,255,0.06);
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}
.modal h3{ margin:0 0 8px 0; color:var(--accent1); font-size:16px; }
.modal .list { text-align:left; margin-top:12px; max-height:320px; overflow:auto; }
.modal .list li { padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,0.03); font-weight:700; }

/* result panel (small) */
#resultModalInner { display:none; margin-top:18px; }

/* small helpers */
.hidden { display:none!important; }
button, input { font-size:16px; } /* prevents iOS zoom on tap */
.active-tab {
  background: linear-gradient(90deg,#FF1493,#FF8C00);
  color: #fff;
  font-weight: bold;
}
body {
  height: 100%;
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 18px 0 120px;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  overflow-x: hidden;

  /* blur effect */
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: -1; /* behind content */
}

body.start-mode {
  background: url('https://cdn.shopify.com/s/files/1/0962/6648/6067/files/9F6F9EAC-F165-4C70-85CB-B2351A3B8C59.png?v=1763282422') no-repeat center center fixed;
  background-size: cover;
}

body.start-mode::before {
  display: none;
}

body.game-mode {
  background: url('https://cdn.shopify.com/s/files/1/0962/6648/6067/files/64EB80F3-9BE7-4D39-8C96-5608B941E4DC.png?v=1763280746') no-repeat center center fixed;
  background-size: cover;
}

.lb-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 6px;
  padding: 8px 10px;
  border-radius: 8px;
}

.lb-avatar {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  object-fit: cover;
}

.lb-info {
  display: flex;
  flex-direction: column;
}

.lb-name {
  font-size: 14px;
  font-weight: 600;
}

.lb-score {
  font-size: 12px;
  opacity: 0.7;
}

/* iOS Haptic Fallback - Shake Effect */
@keyframes shake {
  0% { transform: translate(0, 0); }
  25% { transform: translate(2px, 0); }
  50% { transform: translate(-2px, 0); }
  75% { transform: translate(2px, 0); }
  100% { transform: translate(0, 0); }
}
.shake { 
  animation: shake 0.1s ease-in-out; 
}
/* Add inside <style> */
#bonusBar.flash {
  animation: bonusFlash 0.4s ease-out;
}
@keyframes bonusFlash {
  0%   { box-shadow: 0 0 0 rgba(0,255,100,0); }
  50%  { box-shadow: 0 0 20px rgba(0,255,100,0.9); }
  100% { box-shadow: 0 0 0 rgba(0,255,100,0); }
}
.tiny-action-btn {
  width:52px;
  height:52px;
  border-radius:50%;
  border:none;
  font-size:28px;
  background:linear-gradient(135deg, #FFD700, #FF4500);
  color:#000;
  cursor:pointer;
  transition:all 0.18s ease;
  box-shadow:0 4px 15px rgba(255,215,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.tiny-action-btn:nth-child(2) { background:linear-gradient(135deg,#00D4FF,#0078FF); }
.tiny-action-btn:nth-child(3) { background:linear-gradient(135deg,#00FFA3,#00C853); }
.tiny-action-btn:active {
  transform:scale(0.88);
  filter:brightness(1.4);
}
bar + footer */
  min-height:100vh;
}
#appWrapper {
  padding-bottom:100px;
}
#endGameModal {
  opacity: 1;
  transition: opacity 0.4s ease-out;
}
/* STAR MARKETPLACE ‚Äì GORGEOUS 2025 DESIGN */
.sm-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,0.92);
  backdrop-filter: blur(14px); display: flex;
  align-items: center; justify-content: center;
  z-index: 9999;
}

.sm-modal {
  width: 92%; max-width: 420px; max-height: 92vh;
  background: linear-gradient(135deg, #1a1a2e, #16213e);
  border-radius: 28px; border: 1.5px solid #ffd70033;
  overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.8);
  display: flex; flex-direction: column; color: white;
  font-family: -apple-system, sans-serif;
}

.sm-header {
  padding: 20px; text-align: center;
  background: linear-gradient(135deg, #ffd700, #ffaa00);
  color: #000; font-weight: 900; font-size: 22px; letter-spacing: 1px;
  position: relative;
}

.sm-close {
  position: absolute; top: 14px; right: 16px;
  width: 44px; height: 44px; border-radius: 50%;
  background: rgba(0,0,0,0.4); border: none; color: white;
  font-size: 24px; font-weight: bold; cursor: pointer;
}

.sm-tabs { display: flex; background: rgba(255,255,255,0.08); }
.sm-tab-btn {
  flex: 1; padding: 16px; background: none; border: none;
  color: #ccc; font-size: 17px; font-weight: 600; cursor: pointer;
}
.sm-tab-btn.sm-active {
  background: #ffd700; color: #000; font-weight: bold;
}

.sm-content { flex: 1; overflow: hidden; display: flex; flex-direction: column; }
.sm-tab-content { display: none; flex-direction: column; height: 100%; }
.sm-tab-content.sm-active { display: flex; }

.sm-scroll {
  flex: 1; overflow-y: auto; padding: 0 20px 20px;
  scrollbar-width: thin; scrollbar-color: #ffd700 #333;
}
.sm-scroll::-webkit-scrollbar { width: 6px; }
.sm-scroll::-webkit-scrollbar-thumb { background: #ffd700; border-radius: 3px; }

/* LISTING CARD ‚Äì BEAUTIFUL */
.sm-listing {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,215,0,0.3);
  border-radius: 18px; padding: 18px; margin-top: 16px;
  display: flex; justify-content: space-between; align-items: center;
  backdrop-filter: blur(10px);
}

.sm-listing strong {
  font-size: 24px; color: #ffd700; font-weight: 900;
}
.sm-listing .seller {
  font-size: 16px; font-weight: bold; color: #00ff9d; margin-top: 6px;
}

.sm-buy-btn, .sm-cancel-btn {
  padding: 12px 24px; border-radius: 16px; border: none;
  font-weight: bold; font-size: 16px; cursor: pointer;
}
.sm-buy-btn { background: #ffd700; color: #000; }
.sm-cancel-btn { background: #ff4444; color: white; }

/* SELL FORM */
.sm-sell-form {
  background: rgba(255,255,255,0.08); padding: 20px; border-radius: 20px;
  margin: 20px; border: 1px solid rgba(255,215,0,0.3);
}
.sm-sell-form input {
  width: 100%; padding: 16px; margin: 12px 0;
  background: rgba(0,0,0,0.4); border: 1px solid #ffd70066;
  border-radius: 16px; color: white; font-size: 17px;
}
.sm-btn-primary {
  width: 100%; padding: 18px; margin-top: 16px;
  background: #ffd700; color: #000; border: none;
  border-radius: 18px; font-size: 19px; font-weight: 900; cursor: pointer;
}

.sm-balance { font-size: 18px; text-align: center; margin: 0 0 20px; }
.sm-section-title { margin: 30px 20px 10px; color: #ffd700; font-size: 19px; font-weight: bold; }
.sm-empty { text-align: center; padding: 80px 20px; opacity: 0.7; font-size: 18px; }

     /* Spinner inside button */
  .btn-spinner {
    border: 2px solid rgba(0,0,0,0.1);
    border-top: 2px solid #fff;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    animation: spin 0.7s linear infinite;
    display: inline-block;
    vertical-align: middle;
    margin-right: 6px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
@keyframes scroll{
  0%   { transform:translateX(100vw); }
  100% { transform:translateX(-100%); }
}
#bannerPage { contain: layout style; } /* prevents layout thrashing = no lag */
</style>
</head>
</body>

<div id="appWrapper">
  

  <!-- Header -->
  <div id="gameHeader">
    <div id="welcomeText">WELCOME TO</div>
    <div id="scrambleText">TAP MASTER</div>
  </div>
  
<!-- YOUR FINAL BANNER ‚Äî slim, fast, live, uses your #bannerPage ID -->
<div id="bannerPage" style="background:linear-gradient(90deg,#000,#1a0033,#000);
                           padding:11px 0;
                           border-bottom:3px solid #00FFA3;
                           box-shadow:0 4px 20px rgba(0,255,163,0.5);
                           overflow:hidden;
                           margin:0 auto 20px;
                           max-width:92%;
                           border-radius:12px;">
  
  <div id="liveBannerText" style="display:inline-block; white-space:nowrap; animation:scroll 52s linear infinite; font-size:11.5px; font-weight:700; color:#fff;">
    <!-- JS injects content here -->
    <span style="color:#00FFA3; text-shadow:0 0 10px #00FFA3;">Loading live stats...</span>
  </div>
</div>
  

<!-- Start Page -->
<div id="startPage" style="width:100%;display:flex;flex-direction:column;align-items:center;margin-top:18px;">
  <button id="startBtn" style="padding:12px 22px;border-radius:12px;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:800;font-size:16px;border:none;cursor:pointer;">Play</button>
</div>


<!-- Play Confirmation Modal -->
<div id="playModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:2000;justify-content:center;align-items:center;display:flex;">
  <div style="background:#111;color:#fff;padding:20px;border-radius:12px;width:90%;max-width:320px;text-align:center;">
    <h3 style="margin-bottom:12px;">Confirm Play</h3>
    <p>Play Tap Master for <strong> 10 STRZ ‚≠êÔ∏è </strong>?</p>
    <div style="display:flex;justify-content:space-between;margin-top:18px;">
      <button id="cancelPlay" style="flex:1;margin-right:6px;padding:10px 12px;border:none;border-radius:8px;background:#444;color:#fff;font-weight:700;cursor:pointer;">Cancel</button>
      <button id="confirmPlay" style="flex:1;margin-left:6px;padding:10px 12px;border:none;border-radius:8px;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:700;cursor:pointer;">Confirm</button>
    </div>
  </div>
</div>

<!-- Spinner (loading animation) -->
  <div id="spinner" class="hidden" style="margin-top:18px;">
    <div style="width:44px;height:44px;border-radius:50%;border:6px solid #222;border-top:6px solid #00e676; animation:spin 1s linear infinite;margin:0 auto"></div>
    <div style="margin-top:10px;color:#aaa;font-size:13px">Loading Tap Arena‚Ä¶</div>
  </div>
  

  <!-- Game UI -->
  <div id="gamePage" class="hidden" style="width:100%;display:flex;flex-direction:column;align-items:center;">

    <!-- Glass terminal -->
    <div id="tapTerminal" class="glass-terminal" aria-live="polite">
      <div class="terminal-header">TAP TERMINAL</div>

      <div class="terminal-line">
        <div>‚è± Time Left</div>
        <div><span id="timer">60</span>s</div>
      </div>

      <div class="terminal-line">
        <div>‚úãüèΩ Taps</div>
        <div><span id="tapCount">0</span></div>
      </div>

      <div class="terminal-line">
        <div>üíµ Earnings</div>
        <div>‚Ç¶<span id="earnings">0.00</span></div>
      </div>

      <div id="trainBarContainer" style="margin-top:10px;">
        <div id="trainBar" style="width:100%"></div>
      </div>

      <div class="stats-row" style="margin-top:10px">
        <div class="stat">
          <div class="label">TAP LVL</div>
          <div class="value" id="bonusLevelVal">1</div>
        </div>
        <div class="stat">
          <div class="label">SPEED</div>
          <div class="value" id="speedVal">‚Äî</div>
        </div>
      </div>

      <div id="bonusContainer" style="margin-top:12px;">
        <div id="bonusBar"></div>
      </div>
    </div>

<!-- TAP button (replace your old one) -->
<button id="tapButton" aria-label="Tap" title="Tap fast!">
  <span class="inner">TAP</span>
  <div class="ripple"></div>
</button>
  
    <!-- Result modal -->
<div id="resultModal" class="modal-backdrop" style="display:none;align-items:center;justify-content:center;">
  <div class="modal" style="padding:16px;border-radius:12px;max-width:380px;text-align:center;position:relative;">
    <button id="closeResult" style="position:absolute;top:8px;right:8px;font-size:18px;border:none;background:none;cursor:pointer;">‚úñ</button>
    <div id="resultMessage" style="margin-top:10px;font-size:16px;font-weight:600;"></div>
    <button id="playAgainBtn" style="margin-top:16px;padding:10px 16px;border-radius:8px;border:none;background:linear-gradient(90deg,#00e676,#00b0ff);color:#000;font-weight:800;cursor:pointer;">Play Again</button>
  </div>
</div>

  </div> <!-- end gamePage -->

<!-- FINAL BOTTOM-LOCKED BAR (Profile + Action Buttons) - FIXED & CLEAN -->
<div id="bottomBar" style="position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;padding:14px 0 20px;background:transparent;z-index:997;pointer-events:none;">
  <div style="pointer-events:auto;">
    
    
    
  

    <!-- Profile Card -->
    <div style="background:rgba(255,255,255,0.05);padding:14px 16px;border-radius:16px;border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(12px);width:90%;max-width:420px;margin:0 auto 16px;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,0.4);">
      <div id="profileName" style="font-size:16px;font-weight:700;color:#fff;">GUEST 0000</div>
      <div style="margin-top:8px;font-size:14px;">
        <strong style="background:linear-gradient(90deg,#00e676,#00b0ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">STARS COLLECTED:</strong>
        <span id="starCount" style="color:#fff;">50</span>‚≠êÔ∏è
      </div>
      <div style="margin-top:4px;font-size:14px;">
        <strong style="background:linear-gradient(90deg,#00e676,#00b0ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">CASH EARNED:</strong>
        <span id="cashCount" style="color:#fff;">‚Ç¶0</span>
      </div>
    </div>

    <!-- Tiny Action Bar (Leaderboard + Rules + Bid + STORE) -->
    <div style="display:flex;justify-content:center;gap:18px;padding:10px 18px;background:rgba(255,255,255,0.09);border-radius:24px;border:1px solid rgba(255,255,255,0.14);backdrop-filter:blur(16px);width:88%;max-width:320px;margin:0 auto;box-shadow:0 -8px 30px rgba(0,0,0,0.6);">
      <button id="leaderboardBtn" class="tiny-action-btn" data-title="Leaderboard">üèÜ</button>
      <button id="rulesBtn"        class="tiny-action-btn" data-title="Game Rules">üìã</button>
      <button id="bidBtn"          class="tiny-action-btn" data-title="Place Bid">üèÅ</button>
      <button id="starMarketBtn"   class="tiny-action-btn" data-title="Star Market">üè™</button>
    </div>

  </div>
</div>




<!-- FINAL UNIFORM GOLDEN LEADERBOARD MODAL ‚Äì SCROLLABLE + BIGGER SLIDER -->
<div id="leaderboardModal" class="modal-backdrop" style="display:none;">
  <div class="modal" style="width:88%;max-width:360px;max-height:88vh;display:flex;flex-direction:column;background:#0f0f0f;border:2px solid #FFD700;border-radius:18px;box-shadow:0 0 60px rgba(255,215,0,0.55);">
    
    <!-- HEADER ‚Äì FIXED -->
    <div style="padding:18px 16px 12px;text-align:center;border-bottom:1px solid rgba(255,215,0,0.3);background:rgba(255,215,0,0.07);flex-shrink:0;">
      <h3 style="margin:0;font-family:'Press Start 2P',cursive;font-size:16px;color:#FFD700;line-height:1.2;">
        LEADERBOARD
      </h3>
      <p style="margin:8px 0 0;font-size:13px;color:#FF8C00;font-weight:700;">
        Only the fastest survive
      </p>
    </div>

    <!-- SCROLLABLE CONTENT -->
    <div style="flex:1;overflow-y:auto;padding:16px 18px 10px;font-size:14px;color:#eee;display:flex;flex-direction:column;">

      <!-- Tabs -->
      <div id="leaderboardTabs" style="display:flex;gap:8px;margin-bottom:12px;">
        <button class="lb-tab active" data-period="weekly"
          style="flex:1;padding:10px 0;border-radius:10px;border:none;background:#FFD700;color:#000;font-weight:800;font-size:11.5px;cursor:pointer;box-shadow:0 4px 15px rgba(255,215,0,0.5);letter-spacing:0.5px;">
          THIS WEEK
        </button>
        <button class="lb-tab" data-period="daily"
          style="flex:1;padding:10px 0;border-radius:10px;border:none;background:#222;color:#ccc;font-weight:700;font-size:11.5px;cursor:pointer;">
          TODAY
        </button>
        <button class="lb-tab" data-period="monthly"
          style="flex:1;padding:10px 0;border-radius:10px;border:none;background:#222;color:#ccc;font-weight:700;font-size:11.5px;cursor:pointer;">
          THIS MONTH
        </button>
      </div>

      <!-- Timer -->
      <div id="dailyTimer" style="text-align:center;font-size:13.5px;font-weight:700;color:#FF8C00;margin:10px 0;">
        Reset in: <span id="dailyTimerValue">23:59:59</span>
      </div>

      <!-- IMAGE SLIDER ‚Äì FIXED HEIGHT -->
      <div id="leaderboardImageSlider" style="position:relative;width:100%;height:280px;flex-shrink:0;border-radius:12px;margin-bottom:12px;box-shadow:0 0 20px rgba(255,215,0,0.5);border:2px solid rgba(255,215,0,0.4);overflow:hidden;">
        <div class="slider-track" style="display:flex;width:700%;height:100%;transition:transform 0.6s ease;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
          <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/LIVE_ON_FRIDAYS.png?v=1763616110" class="leaderboard-slide" style="width:100%;height:100%;object-fit:contain;flex-shrink:0;">
        </div>
      </div>

      <!-- Description -->
      <p id="leaderboardDescription" style="font-size:13.8px;color:#ddd;line-height:1.5;margin:10px 0;text-align:center;">
        Checkout today's top tappers who dominate the leaderboard.
      </p>

              <!-- MY TAPS TODAY ‚Äì 2nd 1st 3rd PERFECTLY JOINED -->
      <div id="myTapsToday" style="background:linear-gradient(135deg,rgba(255,215,0,0.18),rgba(255,140,0,0.08));border:1.5px solid #FFD700;border-radius:14px;padding:11px 13px;margin:16px 0 6px;display:flex;align-items:center;gap:10px;box-shadow:0 3px 12px rgba(255,215,0,0.25);">
        <div style="flex-shrink:0;font-size:28px;opacity:0.9;">‚ú®</div>
        
        <div style="flex:1;text-align:center;">
          <div style="font-size:11px;color:#FF8C00;font-weight:800;letter-spacing:0.6px;">
            YOUR TAPS COUNT
          </div>
          
          <div style="margin-top:4px;font-size:19px;font-weight:900;color:#FFD700;display:inline-flex;align-items:baseline;gap:8px;flex-wrap:nowrap;justify-content:center;">
            <span id="myDailyTapsValue">0</span>
            <span style="font-size:13px;font-weight:700;opacity:0.9;align-self:center;">taps</span>
            
            <!-- BIG RANK + SUFFIX TOGETHER IN ONE SPAN SO NO GAP -->
            <span id="myRankFull" style="font-size:19px;font-weight:900;line-height:1;"></span>
            
            <span style="font-size:13px;font-weight:700;opacity:0.9;align-self:center;">position</span>
          </div>
        </div>
        
        <div style="flex-shrink:0;font-size:24px;opacity:0.7;">‚ú®</div>
      </div>
      
      <!-- Leaderboard list -->
      <ol id="leaderboardList" style="list-style:none;padding:0;margin:12px 0 8px;">
      <!-- Leaderboard list -->
      <ol id="leaderboardList" style="list-style:none;padding:0;margin:14px 0 10px;">
        <!-- JS fills this -->
      </ol>

      <!-- Footer note -->
      <div style="text-align:center;font-size:12.5px;color:#777;font-style:italic;padding-bottom:10px;">
        Ëá™ÂàÜ„ÅÆÈõ∞Âõ≤Ê∞ó„ÇíËá™ÂàÜ„ÅÆ„ÇÇ„ÅÆ„Å´„Åó„Çà„ÅÜ
      </div>

    </div>

    <!-- FOOTER ‚Äì FIXED -->
    <div style="padding:16px 20px 20px;text-align:center;background:rgba(0,0,0,0.35);flex-shrink:0;">
      <button id="closeLeaderboard" style="padding:13px 40px;border:none;border-radius:12px;background:linear-gradient(90deg,#FFD700,#FF8C00);color:#000;font-weight:800;font-size:16px;cursor:pointer;min-width:180px;box-shadow:0 8px 25px rgba(255,215,0,0.6);">
        CLOSE THE RANKS
      </button>
    </div>
  </div>
</div>


<!-- FINAL COMPACT DETTYVERSE RULES MODAL -->
<div id="rulesModal" class="modal-backdrop" style="display:none;">
  <div class="modal" style="width:88%;max-width:360px;max-height:88vh;overflow:hidden;display:flex;flex-direction:column;background:#0f0f0f;border:2px solid #FF1493;border-radius:18px;box-shadow:0 0 50px rgba(255,20,147,0.5);">
    
    <!-- Header -->
    <div style="padding:18px 16px 12px;text-align:center;border-bottom:1px solid rgba(255,20,147,0.3);background:rgba(255,20,147,0.05);">
      <h3 style="margin:0;font-family:'Press Start 2P',cursive;font-size:16px;color:#FF1493;line-height:1.2;">
        TapMaster
      </h3>
      <p style="margin:8px 0 0;font-size:13px;color:#00e676;font-weight:600;">
        Tap fast or get left behind.
      </p>
    </div>

    <!-- Scrollable Content -->
    <div style="flex:1;overflow-y:auto;padding:18px 20px;font-size:14.5px;line-height:1.75;color:#eee;">
      <div style="background:rgba(255,20,147,0.15);padding:14px;border-radius:12px;margin-bottom:16px;">
        <strong style="color:#FF1493;">1. Entry</strong><br>
        No STRZ ‚≠êÔ∏è = No play.
      </div>

      <div style="background:rgba(0,230,118,0.15);padding:14px;border-radius:12px;margin-bottom:16px;">
        <strong style="color:#00e676;">2. The Clock</strong><br>
        60 seconds. Every tap counts. Speed is king.
      </div>

      <div style="background:rgba(255,215,0,0.15);padding:14px;border-radius:12px;margin-bottom:16px;">
        <strong style="color:#FFD700;">3. Rewards</strong><br>
        ‚Ä¢ Top 33 every day win cash rewards<br>
        ‚Ä¢ Top 5 every week win cash rewards<br>
        ‚Ä¢ You will win if you tap fast enough
      </div>

      <div style="background:rgba(255,0,0,0.2);padding:14px;border-radius:12px;border:1px solid #ff4444;">
        <strong style="color:#ff4444;">4. The Law</strong><br>
        No bots. No macros. No scripts.<br>
        We detect everything. Cheaters = instant ban + public shame.<br>
        <strong>Play clean. Tap like a master. Win rewards.</strong>
      </div>

      <div style="margin-top:20px;text-align:center;font-size:13px;color:#777;font-style:italic;">
        Ëá™ÂàÜ„ÅÆÈõ∞Âõ≤Ê∞ó„ÇíËá™ÂàÜ„ÅÆ„ÇÇ„ÅÆ„Å´„Åó„Çà„ÅÜ
      </div>
    </div>

    <!-- Close Button -->
    <div style="padding:16px 20px 20px;text-align:center;background:rgba(0,0,0,0.3);">
      <button id="closeRulesBtn" style="padding:13px 36px;border:none;border-radius:12px;background:linear-gradient(90deg,#FF1493,#FF8C00);color:#fff;font-weight:800;font-size:16px;cursor:pointer;min-width:180px;">
        I UNDERSTAND
      </button>
    </div>
  </div>
</div>


<!-- DETTYVERSE BID MODAL ‚Äî FULLY LIVE (Prize + Players + Timer) -->
<div id="bidModal" class="modal-backdrop" style="display:none;">
  <div class="modal" style="width:88%;max-width:360px;max-height:88vh;overflow:hidden;display:flex;flex-direction:column;background:#0f0f0f;border:3px solid #00FFA3;border-radius:18px;box-shadow:0 0 60px rgba(0,255,163,0.6);">
    
    <div style="padding:18px 16px 12px;text-align:center;border-bottom:1px solid rgba(0,255,163,0.4);background:rgba(0,255,163,0.08);">
      <h3 style="margin:0;font-family:'Press Start 2P',cursive;font-size:16px;color:#00FFA3;line-height:1.2;">
        JOIN THE BID
      </h3>
      <p style="margin:8px 0 0;font-size:13px;color:#00e676;font-weight:600;">
        Winners takes the Prize. Losers get to try again next time.
      </p>
    </div>

    <div style="flex:1;overflow-y:auto;padding:18px 20px;font-size:14.8px;line-height:1.8;color:#eee;">
      
      <!-- LIVE PRIZE -->
      <div style="background:rgba(0,255,163,0.15);padding:16px;border-radius:14px;margin-bottom:18px;text-align:center;">
        <div id="livePrize" style="font-size:28px;font-weight:800;color:#00FFA3;">$0</div>
        <div style="font-size:13px;color:#aaa;margin-top:4px;"> Today's Cash Prize </div>
      </div>

      <!-- LIVE PLAYERS + TIMER -->
      <div style="background:rgba(255,215,0,0.15);padding:16px;border-radius:14px;margin-bottom:18px;">
        <strong style="color:#FFD700;">Entry Fee:</strong> 50 STRZ ‚≠êÔ∏è<br>
        <strong style="color:#FFD700;">Players Joined:</strong> <span id="livePlayers">0</span> Playas<br>
        <strong style="color:#FFD700;">Bid Ends In:</strong> <span id="countdownTimer" style="color:#00FFA3;font-weight:900;">--:--:--</span>
      </div>

      <!-- Rest unchanged -->
<div style="background:rgba(255,20,147,0.15); padding:20px 16px; border-radius:14px; margin-bottom:18px; text-align:center;">
  
  <strong style="color:#FF1493; font-size:1.2em; display:block; margin-bottom:16px;">
   Bid Royale
  </strong>

  <div style="font-weight:600; color:#fff; margin:16px 0;">
    Top 5 players split the prize
  </div>

  <!-- Centered bullet list (left-aligned bullets, but block centered) -->
  <ul style="display:inline-block; text-align:left; margin:20px 0; padding-left:22px; line-height:1.7; color:#fff;">
    <li>1st position gets <strong>40%</strong></li>
    <li>2nd position gets <strong>25%</strong></li>
    <li>3rd position gets <strong>20%</strong></li>
    <li>4th position gets <strong>15%</strong></li>
    <li>5th position gets <strong>10%</strong></li>
    <li><strong>No pardons. No excuses.</strong></li>
  </ul>
  
</div>

      <div style="background:rgba(255,0,0,0.2);padding:16px;border-radius:14px;border:1px solid #ff4444;">
        <strong style="color:#ff4444;">Warning</strong><br>
        Once you enter, no backing out.<br>
        You're locked until the bid ends.
      </div>

      <div style="margin-top:20px;text-align:center;font-size:13px;color:#777;font-style:italic;">
        New Rewards & Bid Items Everyday. 
      </div>
    </div>

    <div style="padding:16px 20px 20px;text-align:center;background:rgba(0,0,0,0.4);">
      <button id="confirmBidBtn" style="padding:14px 40px;border:none;border-radius:14px;background:linear-gradient(90deg,#00FFA3,#00C853);color:#000;font-weight:800;font-size:17px;cursor:pointer;min-width:200px;margin-bottom:10px;">
        ENTER
      </button>
      <br>
      <button id="closeBidBtn" style="color:#888;background:none;border:none;font-size:14px;cursor:pointer;">
        Nah, i‚Äôm scared
      </button>
    </div>
  </div>
</div>


<!-- CONFIRMATION MODAL ‚Äì COMPACT & DEADLY EDITION -->
<div id="confirmBidModal" class="modal-backdrop" style="display:none;">
  <div class="modal" style="width:88%;max-width:340px;background:#0f0f0f;border:3px solid #ff2d55;border-radius:18px;box-shadow:0 0 60px rgba(255,45,85,0.5);">
    <div style="padding:20px 18px;text-align:center;">
      
      <!-- Title -->
      <h3 style="margin:0 0 10px;color:#ff2d55;font-size:16px;font-family:'Press Start 2P',cursive;letter-spacing:0.5px;">
        LOCK IN BID?
      </h3>
      
      <!-- Warning Text -->
      <p style="margin:12px 0 18px;color:#ff6b6b;font-size:14px;line-height:1.5;font-weight:500;">
        This deducts <strong style="color:#fff;">50 STRZ ‚≠êÔ∏è</strong> permanently.<br>
        <span style="color:#ff2d55;font-size:13px;">No refund. No escape.</span>
      </p>
      
      <!-- Buttons ‚Äì Smaller, Sleeker, Deadly -->
      <div style="display:flex;gap:10px;justify-content:center;">
        <button id="finalConfirmBtn" style="
          flex:1;
          padding:11px 16px;
          background:#ff2d55;
          color:#fff;
          border:none;
          border-radius:10px;
          font-weight:900;
          font-size:14px;
          letter-spacing:0.5px;
          cursor:pointer;
          box-shadow:0 4px 12px rgba(255,45,85,0.4);
          transition:all 0.2s;
        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
          Yeah!
        </button>
        
        <button id="finalCancelBtn" style="
          flex:1;
          padding:11px 16px;
          background:#222;
          color:#999;
          border:1px solid #444;
          border-radius:10px;
          font-weight:600;
          font-size:14px;
          cursor:pointer;
          transition:all 0.2s;
        " onmouseover="this.style.background='#333'" onmouseout="this.style.background='#222'">
          Nah ü´£
        </button>
      </div>
      
      <!-- Tiny evil footer -->
      <div style="margin-top:16px;font-size:11px;color:#666;font-style:italic;">
        What's tapping yo! 
      </div>
    </div>
  </div>
</div>

<!-- SIMPLE CLEAN ALERT ‚Äî matches your bidModal style -->
<div id="niceAlert" class="modal-backdrop" style="display:none;z-index:9999;">
  <div class="modal" style="width:88%;max-width:340px;background:#0f0f0f;border:3px solid #00FFA3;border-radius:18px;box-shadow:0 0 60px rgba(0,255,163,0.6);">
    <div style="padding:24px 20px;text-align:center;">
      <p id="niceAlertMessage" style="margin:0 0 20px;color:#eee;font-size:15px;line-height:1.5;">Message</p>
      <button id="niceAlertBtn" style="padding:12px 50px;background:linear-gradient(90deg,#00FFA3,#00C853);color:#000;border:none;border-radius:12px;font-weight:800;font-size:15px;cursor:pointer;">
        OKAY
      </button>
    </div>
  </div>
</div>

<!-- STAR MARKETPLACE ‚Äì FINAL BEAUTIFUL VERSION -->
<div id="sm-modal" class="sm-backdrop" style="display:none;">
  <div class="sm-modal">
    <div class="sm-header">
      <h2>STRZ Marketplace</h2>
      <button class="sm-close">X</button>
    </div>

    <div class="sm-tabs">
      <button class="sm-tab-btn sm-active" data-tab="buy">Buy Stars</button>
      <button class="sm-tab-btn" data-tab="sell">Sell Stars</button>
    </div>

    <div class="sm-content">
      <!-- BUY TAB -->
      <div id="sm-buy-tab" class="sm-tab-content sm-active">
        <div id="sm-listings-container" class="sm-scroll"></div>
      </div>

      <!-- SELL TAB -->
      <div id="sm-sell-tab" class="sm-tab-content">
        <div class="sm-scroll">
          <div class="sm-sell-form">
            <p class="sm-balance">You have: <strong id="sm-user-stars">0</strong> Stars</p>
            <input type="number" id="sm-sell-amount" placeholder="Amount (100, 200, 300...)" min="100" step="100">
            <input type="number" id="sm-sell-price" placeholder="Price in ‚Ç¶ (e.g. 2500)" min="50">
            <button id="sm-list-btn" class="sm-btn-primary">List for Sale</button>
          </div>

          <h3 class="sm-section-title">Your Active Listings</h3>
          <div id="sm-my-listings"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- SOUNDS - All your GitHub sounds in one place -->
<audio id="tapSound"     src="https://raw.githubusercontent.com/golalaland/1010/main/pop-reverb-423718.mp3"     preload="auto"></audio>
<audio id="confettiSound" src="https://raw.githubusercontent.com/golalaland/1010/main/material-mold-394512.mp3" preload="auto"></audio>
<audio id="comboSound"    src="https://raw.githubusercontent.com/golalaland/1010/main/clear-combo-7-394494.mp3"    preload="auto"></audio>
<audio id="uiClickSound" src="https://raw.githubusercontent.com/golalaland/1010/main/click-sound-432501.mp3" preload="auto"></audio>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  
  // AUTH ‚Äî onAuthStateChanged lives here
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  
  // FIRESTORE ‚Äî everything else
  import { 
    getFirestore,
    doc,
    getDoc,
    runTransaction,
    collection,
    addDoc,
    serverTimestamp,
    getDocs,
    query,
    where,
    orderBy,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // ---------- FIREBASE CONFIG ----------
  const firebaseConfig = {
    apiKey: "AIzaSyDbKz4ef_eUDlCukjmnK38sOwueYuzqoao",
    authDomain: "metaverse-1010.firebaseapp.com",
    projectId: "metaverse-1010",
    storageBucket: "metaverse-1010.appspot.com",
    messagingSenderId: "1044064238233",
    appId: "1:1044064238233:web:2fbdfb811cb0a3ba349608",
    measurementId: "G-S77BMC266C"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);


// ---------- DOM ----------
const body = document.body;
const startBtn = document.getElementById('startBtn');
const playModal = document.getElementById('playModal');
const cancelPlay = document.getElementById('cancelPlay');
const confirmPlay = document.getElementById('confirmPlay');
const spinner = document.getElementById('spinner');
const startPage = document.getElementById('startPage');
const gamePage = document.getElementById('gamePage');
const tapButton = document.getElementById('tapButton');
const tapSound = document.getElementById('tapSound');
const timerEl = document.getElementById('timer');
const tapCountEl = document.getElementById('tapCount');
const earningsEl = document.getElementById('earnings');
const bonusBar = document.getElementById('bonusBar');
const trainBar = document.getElementById('trainBar');
const bonusLevelVal = document.getElementById('bonusLevelVal');
const speedVal = document.getElementById('speedVal');
const miniTapCount = document.getElementById('miniTapCount');
const miniEarnings = document.getElementById('miniEarnings');
const posterImg = document.getElementById('posterImg');
const starCountEl = document.getElementById('starCount');
const cashCountEl = document.getElementById('cashCount');
const profileNameEl = document.getElementById('profileName');


// Prevent sound spam
window.lastSoundTime = 0;

document.getElementById('leaderboardBtn').onclick = () => {
  document.getElementById('sideTab').classList.toggle('closed');
};


// ========= ULTRA-RELIABLE BLACK CUTE MODAL (TAPS + ‚Ç¶) =========
const endGameModal = document.createElement('div');
endGameModal.id = "endGameModal";
endGameModal.style.cssText = `
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.94);backdrop-filter:blur(12px);
  display:none;justify-content:center;align-items:center;
  z-index:9999;font-family:'Poppins',sans-serif;padding:20px;
`;

endGameModal.innerHTML = `
  <div style="background:#0a0a0a;color:#fff;max-width:360px;width:100%;
    border-radius:22px;text-align:center;padding:30px 20px;
    border:2px solid #0f9;box-shadow:0 0 30px rgba(0,255,150,0.3);">
    
    <h2 style="margin:0 0 20px;font-size:24px;color:#0f9;">ROUND COMPLETE!</h2>

    <p style="font-size:19px;line-height:1.6;margin:20px 0;
      background:rgba(0,255,150,0.1);padding:18px;border-radius:14px;
      border-left:4px solid #0f9;">
      You got <strong id="finalTaps" style="color:#0ff;font-size:22px;">0</strong> taps<br>
      and earned <strong id="finalEarnings" style="color:#0f9;font-size:24px;">‚Ç¶0</strong><br>
      on this tap session.
    </p>

    <p style="margin:15px 0 0;font-size:16px;opacity:0.9;">
      <span id="playerName">player</span> ‚Äî keep dominating!
    </p>

    <div style="display:flex;gap:14px;margin-top:28px;">
      <button id="shareBtn" style="flex:1;padding:15px;border:none;border-radius:14px;
        background:#00ffaa;color:#000;font-weight:bold;font-size:16px;cursor:pointer;">
        SHARE SCORE
      </button>

<button id="playAgainBtn" 
        style="flex:1;padding:15px;border:none;border-radius:14px;
               background:#ff00aa;color:#fff;font-weight:bold;font-size:16px;
               cursor:pointer;position:relative;z-index:999999;
               box-shadow:0 5px 15px rgba(255,0,170,0.4);"
        onclick="location.reload(true)">
  PLAY AGAIN
</button>
    </div>
  </div>
`;

// 1. Add modal to page
document.body.appendChild(endGameModal);

// 2. SHOW FUNCTION
function showEndGameModal() {
  document.getElementById('finalTaps').textContent = taps.toLocaleString();
  document.getElementById('finalEarnings').textContent = `‚Ç¶${earnings.toLocaleString()}`;
  document.getElementById('playerName').textContent = currentUser?.handle || "Tapper";

  // victory sound
  new Audio('https://raw.githubusercontent.com/golalaland/1010/main/material-chest-open-394472.mp3').play().catch(()=>{});

  endGameModal.style.display = "flex";
}

// 3. THIS IS THE FIX ‚Äî attach Play Again AFTER everything, with a tiny safety delay
setTimeout(() => {
  const playAgainBtn = document.getElementById('playAgainBtn');
  if (playAgainBtn) {
    // Remove any old listeners first (prevents duplicates)
    playAgainBtn.replaceWith(playAgainBtn.cloneNode(true));
    document.getElementById('playAgainBtn').addEventListener('click', () => {
      location.reload(true);   // forces full reload, no cache nonsense
    });
  }

  // Share button (also re-attached safely)
  document.getElementById('shareBtn')?.addEventListener('click', () => {
    const name = document.getElementById('playerName').textContent;
    const text = `${name} just got ${taps.toLocaleString()} taps and earned ‚Ç¶${earnings.toLocaleString()}! Beat me if you can!`;
    if (navigator.share) {
      navigator.share({title: "My Tap Score", text, url: location.href});
    } else {
      navigator.clipboard.writeText(text + " " + location.href);
      alert("Score copied!");
    }
  });

}, 100);   // 100




// ---------- CONFIG ----------
const STAR_COST = 10;
const DAILY_INITIAL_POT = 10000;
const CASH_PER_AWARD = 1;
const SESSION_DURATION = 60;

// ---------- STATE ----------
let currentUser = null;
const tapEvent = ('ontouchstart' in window) ? 'touchstart' : 'click';

// ---------- LOCAL POT ----------
const KEY_POT = 'moneytrain_pot';
const KEY_RESET_DAY = 'moneytrain_reset_day';
function getStoredPot(){ return parseInt(localStorage.getItem(KEY_POT)) || null; }
function setStoredPot(v){ localStorage.setItem(KEY_POT, Math.max(0, Math.floor(v))); }
function getPotResetDay(){ return localStorage.getItem(KEY_RESET_DAY) || null; }
function setPotResetDay(s){ localStorage.setItem(KEY_RESET_DAY, s); }

function initializePot(){
  const today = new Date().toISOString().slice(0,10);
  if(!getStoredPot() || getPotResetDay() !== today){
    setStoredPot(DAILY_INITIAL_POT);
    setPotResetDay(today);
  }
}

function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function formatNumber(n){ return n.toLocaleString(); }

// ---------- LOAD USER ----------
async function loadCurrentUserForGame() {
  try {
    const vipRaw = localStorage.getItem("vipUser");
    const hostRaw = localStorage.getItem("hostUser");
    const storedUser = vipRaw ? JSON.parse(vipRaw) : hostRaw ? JSON.parse(hostRaw) : null;
    if(!storedUser?.email){
      currentUser=null;
      profileNameEl && (profileNameEl.textContent="GUEST 0000");
      starCountEl && (starCountEl.textContent="50");
      cashCountEl && (cashCountEl.textContent="‚Ç¶0");
      return;
    }
    const uid = storedUser.email.replace(/\./g,",").toLowerCase();
    const userRef = doc(db,"users",uid);
    const snap = await getDoc(userRef);
    if(!snap.exists()){
      currentUser = { uid, email: storedUser.email, chatId: storedUser.fullName||storedUser.displayName||storedUser.email.split("@")[0], stars:0, cash:0, totalTaps:0 };
      profileNameEl && (profileNameEl.textContent=currentUser.chatId);
      starCountEl && (starCountEl.textContent="0");
      cashCountEl && (cashCountEl.textContent='‚Ç¶0');
      return;
    }
    const data = snap.data(); if(data.uid) delete data.uid;
    currentUser = { uid, ...data, stars:Number(data.stars||0), cash:Number(data.cash||0), totalTaps:Number(data.totalTaps||0) };
    profileNameEl && (profileNameEl.textContent=currentUser.chatId);
    starCountEl && (starCountEl.textContent=formatNumber(currentUser.stars));
    cashCountEl && (cashCountEl.textContent='‚Ç¶'+formatNumber(currentUser.cash));
  } catch(err){ console.warn("loadCurrentUserForGame error",err); }
}

// ---------- DEDUCT STARS ----------
async function tryDeductStarsForJoin(cost){
  if(!currentUser?.uid) return {ok:false,message:"You are not logged in"};
  const userRef = doc(db,"users",currentUser.uid);
  try{
    await runTransaction(db,async t=>{
      const u = await t.get(userRef);
      if(!u.exists()) throw new Error("User not found");
      const currentStars = Number(u.data().stars||0);
      if(currentStars<cost) throw new Error("Not enough stars");
      t.update(userRef,{stars:currentStars-cost});
      currentUser.stars = currentStars-cost;
    });
    starCountEl && (starCountEl.textContent=formatNumber(currentUser.stars));
    return {ok:true};
  } catch(e){ return {ok:false,message:e.message||"Could not deduct stars"}; }
}

// ---------- GIVE CASH ----------
async function giveCashToUser(amount){
  if(!currentUser?.uid) return {ok:false};
  const userRef = doc(db,"users",currentUser.uid);
  try{
    await runTransaction(db,async t=>{
      const u = await t.get(userRef);
      if(!u.exists()) throw new Error("User not found");
      const newCash = Number(u.data().cash||0) + Number(amount);
      t.update(userRef,{cash:newCash});
      currentUser.cash = newCash;
    });
    cashCountEl && (cashCountEl.textContent='‚Ç¶'+formatNumber(currentUser.cash));
    return {ok:true};
  } catch(e){ console.error("giveCashToUser error", e); return {ok:false,message:e.message}; }
}

// ---------- FLOATING +1 ----------
function showFloatingPlus(parent,text){
  const span=document.createElement('span');
  span.textContent=text;
  const rect = parent.getBoundingClientRect();
  const x = rect.left + Math.random() * rect.width * 0.6 + rect.width*0.2;
  const y = rect.top + Math.random() * rect.height * 0.6;
  Object.assign(span.style,{
    position:'absolute', fontWeight:'bold', color:'#fff', fontSize:'20px',
    pointerEvents:'none', userSelect:'none', zIndex:1000,
    top: y+'px', left: x+'px', opacity:1, transition:'all 0.9s ease-out'
  });
  document.body.appendChild(span);
  setTimeout(()=>{ span.style.top=(y-40)+'px'; span.style.opacity=0; },50);
  setTimeout(()=>span.remove(),900);
}

// ---------- BONUS BAR ----------
function updateBonusBar(){
  if(!bonusBar) return;
  const colors = [
    `linear-gradient(90deg, #ff416c, #ff4b2b)`,
    `linear-gradient(90deg, #00c6ff, #0072ff)`,
    `linear-gradient(90deg, #f7971e, #ffd200)`,
    `linear-gradient(90deg, #a1ffce, #faffd1)`,
    `linear-gradient(90deg, #ff9a9e, #fad0c4)`,
    `linear-gradient(90deg, #ffecd2, #fcb69f)`
  ];
  const idx = randomInt(0, colors.length-1);
  bonusBar.style.background = colors[idx];
  bonusBar.style.width = Math.min(100,(progress/tapsForNext)*100)+'%';
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DOPE RANDOM CONFETTI + VIBRATION + EPIC SOUND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function triggerConfetti() {
  // Play your custom confetti explosion sound
  play(confettiSound, 0.85);

  const types = ['rainbow', 'spark', 'coin', 'star'];
  const chosen = types[Math.floor(Math.random() * types.length)];

  const count = 22;
  const rect  = tapButton.getBoundingClientRect();
  const cx    = rect.left + rect.width  / 2;
  const cy    = rect.top  + rect.height / 2;

  for (let i = 0; i < count; i++) {
    const dot = document.createElement('div');
    dot.className = `confetti-dot confetti-${chosen}`;

    const angle = Math.random() * Math.PI * 2;
    const dist  = 40 + Math.random() * 80;
    const dx    = Math.cos(angle) * dist;
    const dy    = Math.sin(angle) * dist - 60;

    dot.style.setProperty('--dx', `${dx}px`);
    dot.style.setProperty('--dy', `${dy}px`);
    dot.style.left = `${cx}px`;
    dot.style.top  = `${cy}px`;

    if (chosen === 'rainbow') dot.style.setProperty('--h', Math.random() * 360);

    document.body.appendChild(dot);

    dot.animate(
      [
        { opacity: 1, transform: 'translate(0,0) rotate(0deg) scale(1)' },
        { opacity: 0, transform: `translate(${dx}px,${dy}px) rotate(${chosen === 'coin' ? '720deg' : '360deg'}) scale(${chosen === 'star' ? 2 : 0})` }
      ],
      {
        duration: 600 + Math.random() * 300,
        easing: 'cubic-bezier(.2,.6,.4,1)'
      }
    ).onfinish = () => dot.remove();
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DOPE VIBRATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if ('vibrate' in navigator) {
    navigator.vibrate([80, 50, 100, 50, 80]);
  } else if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
    tapButton.classList.add('shake');
    setTimeout(() => tapButton.classList.remove('shake'), 400);
  }
}

// ======================================================
//   SESSION ENGINE ‚Äî CLEAN, BULLETPROOF, DROP-IN
// ======================================================

// GLOBAL STATE
let taps = 0;
let earnings = 0;
let timer = 0;
let bonusLevel = 1;
let progress = 0;
let tapsForNext = 100;
let cashCounter = 0;
let cashThreshold = 0;

let running = false;
let tapLocked = false;
let intervalId = null;


// ======================================================
//   START SESSION
// ======================================================
function startSession() {

  // Reset state
  taps = 0;
  earnings = 0;
  timer = SESSION_DURATION;
  bonusLevel = 1;
  progress = 0;
  tapsForNext = 100;
  cashCounter = 0;
  cashThreshold = randomInt(1, 12);

  running = true;
  tapLocked = false;
  tapButton.disabled = false;

  trainBar && (trainBar.style.width = "100%");
  updateBonusBar();
  updateUI();

  // Clear old interval
  if (intervalId) clearInterval(intervalId);

  // NEW SAFE COUNTDOWN
  intervalId = setInterval(() => {

    if (!running) return;   

    timer--;
if (timer < 0) timer = 0;

updateUI();
trainBar && (trainBar.style.width = (timer / SESSION_DURATION * 100) + "%");
    if (timer < 0) timer = 0;

    updateUI();
    trainBar && (trainBar.style.width = (timer / SESSION_DURATION * 100) + "%");

    if (timer === 0) {

      // üö´ STOP EVERYTHING IMMEDIATELY
      endSessionImmediate();

      // üìù SAVE THE SESSION ASYNC
      endSessionRecord();

    }

  }, 1000);

  updateUI();
}

  // ======================================================
//   INSTANT END ‚Äî UI FREEZE, BLOCK TAPS (FIXED!)
// ======================================================
function endSessionImmediate() {
¬†¬†running = false;
¬†¬†tapLocked = true;
¬†¬†tapButton.disabled = true;
¬†¬†clearInterval(intervalId);
¬†¬†showEndGameModal();
}

// ======================================================
//   FIRESTORE ‚Äî ASYNC RECORDING
// ======================================================
async function endSessionRecord() {

  if (!currentUser?.uid || taps <= 0) return;

  try {
    const userRef = doc(db, "users", currentUser.uid);

    await runTransaction(db, async t => {

      const docSnap = await t.get(userRef);
      const now = new Date();

      const dailyKey = now.toISOString().split("T")[0];
      const weeklyKey = `${now.getFullYear()}-W${getWeek(now)}`;
      const monthlyKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`;

      if (!docSnap.exists()) {

        t.set(userRef, {
          chatId: currentUser.chatId || currentUser.uid,
          stars: currentUser.stars || 0,
          cash: currentUser.cash || 0,
          totalTaps: taps,
          tapsDaily: { [dailyKey]: taps },
          tapsWeekly: { [weeklyKey]: taps },
          tapsMonthly: { [monthlyKey]: taps },
          lastEarnings: earnings,
          lastBonus: bonusLevel
        });

        return;
      }

      const data = docSnap.data();

      t.update(userRef, {
        totalTaps: (data.totalTaps || 0) + taps,
        tapsDaily: { ...(data.tapsDaily || {}), [dailyKey]: ((data.tapsDaily?.[dailyKey] || 0) + taps) },
        tapsWeekly: { ...(data.tapsWeekly || {}), [weeklyKey]: ((data.tapsWeekly?.[weeklyKey] || 0) + taps) },
        tapsMonthly: { ...(data.tapsMonthly || {}), [monthlyKey]: ((data.tapsMonthly?.[monthlyKey] || 0) + taps) },
        lastEarnings: earnings,
        lastBonus: bonusLevel
      });

    });

    await addDoc(collection(db, "tapSessions"), {
      uid: currentUser.uid,
      email: currentUser.email,
      chatId: currentUser.chatId || currentUser.uid,
      taps,
      earnings,
      bonusLevel,
      timestamp: serverTimestamp()
    });

    currentUser.totalTaps = (currentUser.totalTaps || 0) + taps;

    // Refresh leaderboard
    fetchLeaderboard("daily");

  } catch (err) {
    console.error("Error saving session:", err);
  }
}

// ======================================================
//   TAP HANDLER ‚Äî FIXED SOUND + CROSS-PLATFORM HAPTICS
// ======================================================
function debounce(fn, delay) {
  let timeout;
  return (...args) => {
    clearTimeout(timeout);
    timeout = setTimeout(() => fn(...args), delay);
  };
}

tapButton?.addEventListener(
  tapEvent,
  debounce(async e => {

    if (!running || tapLocked) return;

    tapLocked = true;
    setTimeout(() => (tapLocked = false), 50);

    taps++;
    if (currentUser) {
      currentUser.totalTaps = (currentUser.totalTaps || 0) + 1;
    }

    progress++;
    cashCounter++;
    showFloatingPlus(tapButton, "+1");

    // CASH AWARD
    if (cashCounter >= cashThreshold) {
      cashCounter = 0;
      cashThreshold = randomInt(1, 12);

      const pot = getStoredPot() ?? DAILY_INITIAL_POT;
      if (pot > 0) {
        earnings += CASH_PER_AWARD;
        setStoredPot(Math.max(0, pot - CASH_PER_AWARD));
        await giveCashToUser(CASH_PER_AWARD);
      }
    }

    // BONUS LEVEL
    if (progress >= tapsForNext) {
      progress = 0;
      bonusLevel++;
      tapsForNext = 100 + (bonusLevel - 1) * 50;
      triggerConfetti();
    }

    flashTapGlow();

    // SOUND ‚Äî debounced
    const now = Date.now();
    if (!window.lastSoundTime || now - window.lastSoundTime > 100) {
      try {
        tapSound.currentTime = 0;
        tapSound.play().catch(() => {});
      } catch {}
      window.lastSoundTime = now;
    }

    // HAPTICS
    if ("vibrate" in navigator) {
      navigator.vibrate([10, 5, 10]);
    } else if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
      tapButton.classList.add("shake");
      setTimeout(() => tapButton.classList.remove("shake"), 100);
    }

    updateUI();
    updateBonusBar();

  }, 50)
);


// ---------- UI & TAP GLOW ----------
function updateUI(){
  timerEl && (timerEl.textContent=String(timer));
  tapCountEl && (tapCountEl.textContent=String(taps));
  earningsEl && (earningsEl.textContent='‚Ç¶'+formatNumber(earnings.toFixed(2)));
  bonusLevelVal && (bonusLevelVal.textContent=String(bonusLevel));
  const elapsed=SESSION_DURATION-timer;
  const speed=elapsed>0?taps/elapsed:0;
  speedVal && (speedVal.textContent=`x${speed.toFixed(2)}`);
  miniTapCount && (miniTapCount.textContent=String(taps));
  miniEarnings && (miniEarnings.textContent='‚Ç¶'+formatNumber(earnings.toFixed(2)));
  if(starCountEl && currentUser) starCountEl.textContent=formatNumber(currentUser.stars);
  if(cashCountEl && currentUser) cashCountEl.textContent='‚Ç¶'+formatNumber(currentUser.cash);
}

function flashTapGlow(){ 
  tapButton?.classList.add('tap-glow','tap-pulse'); 
  setTimeout(()=>{tapButton?.classList.remove('tap-glow','tap-pulse');},120); 
}

// ---------- CSS ----------
const style=document.createElement('style'); 
style.innerHTML=`
  #tapButton.tap-glow { box-shadow:0 0 26px rgba(0,230,118,0.9),0 0 8px rgba(0,176,255,0.6); }
  #tapButton.tap-pulse { transform: scale(1.05); transition: transform 0.12s ease; }
`;
document.head.appendChild(style);

// ---------- INITIALIZE ----------
initializePot();
loadCurrentUserForGame();
  
// ---------- START FLOW ----------
startBtn?.addEventListener("click", () => {
  if (playModal) playModal.style.display = "flex";
});

cancelPlay?.addEventListener("click", () => {
  if (playModal) playModal.style.display = "none";
});

confirmPlay?.addEventListener("click", async () => {
  let localStars = parseInt(starCountEl?.textContent.replace(/,/g, '') || "0", 10);

  if (currentUser?.uid) {
    const r = await tryDeductStarsForJoin(STAR_COST);
    if (!r.ok) {
      alert(r.message || "Not enough stars");
      return;
    }
  } else {
    if (localStars < STAR_COST) {
      alert("Not enough stars");
      return;
    }
    localStars -= STAR_COST;
    starCountEl.textContent = formatNumber(localStars);
  }


 // CLOSE MODAL
  if (playModal) playModal.style.display = "none";

  // HIDE START ELEMENTS
  if (posterImg) posterImg.style.display = "none";
  if (startPage) startPage.style.display = "none";
if (bannerPage) bannerPage.style.display = "none";
  // SHOW SPINNER
  if (spinner) spinner.classList.remove("hidden");

  // üîµ ADD BACKGROUND TRANSITION HERE
  body.style.transition = "background 0.5s ease";
  body.classList.remove("start-mode");
  body.classList.add("game-mode");

  // ENTER GAME AFTER DELAY
  setTimeout(() => {
    if (spinner) spinner.classList.add("hidden");
    if (gamePage) gamePage.classList.remove("hidden");
    startSession();
  }, 700);
});

/* ------------------------------
   LEADERBOARD SETUP (FIXED + CLEAN)
------------------------------- */

/* ---------- DOM ---------- */
const leaderboardBtn = document.getElementById("leaderboardBtn");
const leaderboardModal = document.getElementById("leaderboardModal");
const closeLeaderboard = document.getElementById("closeLeaderboard");
const leaderboardList = document.getElementById("leaderboardList");
const leaderboardSlides = document.querySelectorAll(".leaderboard-slide");
const leaderboardDescription = document.getElementById("leaderboardDescription");
const periodTabs = document.querySelectorAll(".lb-tab");
const dailyTimerContainer = document.getElementById("dailyTimer"); // FIXED


/* -------------------------------------------
   LEADERBOARD KEY HELPERS
-------------------------------------------- */
function getLeaderboardKey(period) {
  const now = new Date();
  if (period === "daily") return now.toISOString().split("T")[0];
  if (period === "weekly") return `${now.getFullYear()}-W${getWeek(now)}`;
  if (period === "monthly")
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}`;
  return null;
}

function getWeek(date) {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
  return Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
}


/* ------------------------------
   LEADERBOARD IMAGE SLIDER (FADE)
------------------------------- */
const sliderWrapper = document.getElementById("leaderboardImageSlider");
const sliderTrack = sliderWrapper.querySelector(".slider-track");
const slides = sliderWrapper.querySelectorAll(".leaderboard-slide");

let currentSlide = 0;
let slideInterval = null;
const slideCount = slides.length;

// Move slider to a given index
function showSlide(index) {
  currentSlide = index;
  sliderTrack.style.transform = `translateX(-${index * 100}%)`;
}

// Auto-slide every 3 seconds
function startSlider() {
  slideInterval = setInterval(() => {
    let next = (currentSlide + 1) % slideCount;
    showSlide(next);
  }, 21000);
}

function stopSlider() {
  clearInterval(slideInterval);
}

// Mobile swipe support
let startX = 0;

sliderWrapper.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
  stopSlider();
});

sliderWrapper.addEventListener("touchend", e => {
  let endX = e.changedTouches[0].clientX;
  if (endX - startX > 50) {
    // swipe right
    let prev = (currentSlide - 1 + slideCount) % slideCount;
    showSlide(prev);
  }
  if (startX - endX > 50) {
    // swipe left
    let next = (currentSlide + 1) % slideCount;
    showSlide(next);
  }
  startSlider();
});

// Init
showSlide(0);
startSlider();

// Optional: stop when closing leaderboard modal
closeLeaderboard?.addEventListener("click", () => stopSlider());

/* -------------------------------------------
   FETCH LEADERBOARD
-------------------------------------------- */
async function fetchLeaderboard(period = "daily", top = 10) {
  leaderboardList.innerHTML = "<li>Loading...</li>";

  const key = getLeaderboardKey(period);
  const usersCol = collection(db, "users");

  try {
    const snap = await getDocs(usersCol);
    const scores = [];

    snap.forEach(docSnap => {
      const data = docSnap.data();

      let tapsCount = 0;
      if (period === "daily") tapsCount = data.tapsDaily?.[key] || 0;
      if (period === "weekly") tapsCount = data.tapsWeekly?.[key] || 0;
      if (period === "monthly") tapsCount = data.tapsMonthly?.[key] || 0;

      if (tapsCount > 0) {
        scores.push({
          uid: docSnap.id,
          chatId: data.chatId || docSnap.id.slice(0, 6),
          taps: tapsCount,
        });
      }
    });

      scores.sort((a, b) => b.taps - a.taps);
    const topScores = scores.slice(0, top);
    

     // === YOUR TAPS TODAY ‚Äì FINAL FIXED (2nd 1st 3rd joined perfectly) ===
    let myDailyTaps = 0;
    let myRank = null;

    if (currentUser) {
      const myDoc = snap.docs.find(d => d.id === currentUser.uid);
      const myData = myDoc?.data();
      if (period === "daily")   myDailyTaps = myData?.tapsDaily?.[key]   || 0;
      if (period === "weekly")  myDailyTaps = myData?.tapsWeekly?.[key]  || 0;
      if (period === "monthly") myDailyTaps = myData?.tapsMonthly?.[key] || 0;

      const myEntry = scores.find(s => s.uid === currentUser.uid);
      if (myEntry) myRank = scores.indexOf(myEntry) + 1;
    }

    const tapsEl = document.getElementById("myDailyTapsValue");
    const rankFull = document.getElementById("myRankFull");

    if (tapsEl) tapsEl.textContent = myDailyTaps.toLocaleString();

    if (myRank && myRank <= 10 && rankFull) {
      const suffix = myRank === 1 ? "st" : myRank === 2 ? "nd" : myRank === 3 ? "rd" : "th";
      rankFull.textContent = myRank + suffix;  // 2nd, 1st, 3rd, 4th ‚Äî perfect!
    } else if (rankFull) {
      rankFull.textContent = "";
    }

    if (topScores.length === 0) {
      leaderboardList.innerHTML = "<li style='text-align:center;padding:20px 0;font-size:13px;color:#888;'>No taps yet ‚Äî be the first!</li>";
      return;
    }
leaderboardList.innerHTML = topScores
  .map((u, i) => {
    const isCurrent = currentUser && u.uid === currentUser.uid;

  // ---- Avatar selection (random if no gender) ----
    const maleAvatar = "https://cdn.shopify.com/s/files/1/0962/6648/6067/files/9720029.jpg?v=1763635357";
    const femaleAvatar = "https://cdn.shopify.com/s/files/1/0962/6648/6067/files/10491827.jpg?v=1763635326";

    const avatar = u.gender === "female"
      ? femaleAvatar
      : u.gender === "male"
        ? maleAvatar
        : Math.random() < 0.5 ? maleAvatar : femaleAvatar;

// ---- Name formatting ----
const name = u.chatId || "Anon";
const formattedName = name
  .split(" ")
  .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
  .join(" ");

    // ---- Styles for ranks ----
    let style = "";
    if (i === 0) style = "color:#FFD700;font-weight:700;";
    else if (i === 1) style = "color:#C0C0C0;font-weight:700;";
    else if (i === 2) style = "color:#CD7F32;font-weight:700;";
    else if (isCurrent) style = "background:#333;padding:4px;border-radius:4px;";

    return `
      <li class="lb-row" style="${style}">
        <img class="lb-avatar" src="${avatar}" alt="avatar">
        <div class="lb-info">
          <span class="lb-name">${i + 1}. ${formattedName}</span>
          <span class="lb-score">${u.taps.toLocaleString()} taps</span>
        </div>
      </li>
    `;
  })
  .join("");
  } catch (err) {
    console.error("Leaderboard error:", err);
    leaderboardList.innerHTML = "<li>Error loading leaderboard</li>";
  }
}


/* -------------------------------------------
   TAB SWITCHER (CLEAN + FULLY WORKING)
-------------------------------------------- */
periodTabs.forEach(tab => {
  tab.addEventListener("click", () => {
    const period = tab.dataset.period;

    // Highlight active tab
    periodTabs.forEach(t => {
      t.classList.remove("active");
      t.style.background = "#222";
      t.style.color = "#ccc";
    });

    tab.classList.add("active");
    tab.style.background = "#ff1493";
    tab.style.color = "#fff";

    // Toggle timer
    dailyTimerContainer.style.display = period === "daily" ? "block" : "none";

    // Fetch leaderboard
    fetchLeaderboard(period);
  });
});

/* -------------------------------------------
   DAILY COUNTDOWN
-------------------------------------------- */
function startDailyCountdown() {
  const countdownEl = document.getElementById("dailyTimerValue");

  function updateCountdown() {
    const now = new Date();
    const nextReset = new Date();
    nextReset.setHours(24, 0, 0, 0);

    const diff = Math.max(0, Math.floor((nextReset - now) / 1000));

    const h = String(Math.floor(diff / 3600)).padStart(2, "0");
    const m = String(Math.floor((diff % 3600) / 60)).padStart(2, "0");
    const s = String(diff % 60).padStart(2, "0");

    countdownEl.textContent = `${h}:${m}:${s}`;
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);
}



/* -------------------------------------------
   MODAL OPEN/CLOSE
-------------------------------------------- */
leaderboardBtn?.addEventListener("click", () => {
  leaderboardModal.style.display = "flex";

  startDailyCountdown();
  fetchLeaderboard("daily");

  // auto-switch active tab
  document.querySelector('.lb-tab[data-period="daily"]').click();
});

closeLeaderboard?.addEventListener("click", () => {
  leaderboardModal.style.display = "none";
});


let musicStarted = true;

function startGameMusic() {
  if (!musicStarted) {
    const audio = document.getElementById("gameMusic");
    audio.volume = 0.45; // perfect level behind tapping
    audio.play().catch(()=>{});
    musicStarted = true;
  }
}
document.addEventListener("click", startGameMusic);
document.addEventListener("touchstart", startGameMusic);

document.addEventListener('DOMContentLoaded', function() {
  const body = document.body;
  body.classList.add('start-mode');

  const startBtn = document.getElementById('startBtn');
  const playModal = document.getElementById('playModal');
  const cancelPlay = document.getElementById('cancelPlay');
  const confirmPlay = document.getElementById('confirmPlay');
  const startPage = document.getElementById('startPage');
  const gamePage = document.getElementById('gamePage');
  const bannerPage = document.getElementById('bannerPage');

  if (startBtn) {
    startBtn.addEventListener('click', function() {
      if (playModal) playModal.style.display = 'flex';
    });
  }

  if (cancelPlay) {
    cancelPlay.addEventListener('click', function() {
      if (playModal) playModal.style.display = 'none';
    });
  }

  if (confirmPlay) {
    confirmPlay.addEventListener('click', function() {
      if (playModal) playModal.style.display = 'none';
      if (startPage) startPage.classList.add('hidden');
      if (bannerPage) bannerPage.classList.add('hidden');
      if (gamePage) gamePage.classList.remove('hidden');
      body.classList.remove('start-mode');
      body.classList.add('game-mode');
      // Add your game start logic here (e.g., timer, taps, etc.)
    });
  }
});
document.addEventListener("DOMContentLoaded", () => {

  // URL of your custom star SVG hosted on Shopify
  const customStarURL = "https://cdn.shopify.com/s/files/1/0962/6648/6067/files/starssvg.svg?v=1761770774";

  // Replace stars in text nodes with SVG + floating stars (invisible)
  function replaceStarsWithSVG(root = document.body) {
    if (!root) return;

    const walker = document.createTreeWalker(
      root,
      NodeFilter.SHOW_TEXT,
      {
        acceptNode: node => {
          if (node.nodeValue.includes("‚≠ê") || node.nodeValue.includes("‚≠êÔ∏è")) {
            return NodeFilter.FILTER_ACCEPT;
          }
          return NodeFilter.FILTER_REJECT;
        }
      }
    );

    const nodesToReplace = [];
    while (walker.nextNode()) nodesToReplace.push(walker.currentNode);

    nodesToReplace.forEach(textNode => {
      const parent = textNode.parentNode;
      if (!parent) return;

      const fragments = textNode.nodeValue.split(/‚≠êÔ∏è?|‚≠ê/);

      fragments.forEach((frag, i) => {
        if (frag) parent.insertBefore(document.createTextNode(frag), textNode);

        if (i < fragments.length - 1) {
          // Inline star
          const span = document.createElement("span");
          span.style.display = "inline-flex";
          span.style.alignItems = "center";
          span.style.position = "relative";

          const inlineStar = document.createElement("img");
          inlineStar.src = customStarURL;
          inlineStar.alt = "‚≠ê";
          inlineStar.style.width = "1.2em";
          inlineStar.style.height = "1.2em";
          inlineStar.style.display = "inline-block";
          inlineStar.style.verticalAlign = "text-bottom";
          inlineStar.style.transform = "translateY(0.15em) scale(1.2)";

          span.appendChild(inlineStar);
          parent.insertBefore(span, textNode);

          // Floating star (fully invisible)
          const floatingStar = document.createElement("img");
          floatingStar.src = customStarURL;
          floatingStar.alt = "‚≠ê";
          floatingStar.style.width = "40px";
          floatingStar.style.height = "40px";
          floatingStar.style.position = "absolute";
          floatingStar.style.pointerEvents = "none";
          floatingStar.style.zIndex = "9999";
          floatingStar.style.opacity = "0";
          floatingStar.style.transform = "translate(-50%, -50%)";

          const rect = inlineStar.getBoundingClientRect();
          floatingStar.style.top = `${rect.top + rect.height / 2 + window.scrollY}px`;
          floatingStar.style.left = `${rect.left + rect.width / 2 + window.scrollX}px`;

          document.body.appendChild(floatingStar);

          setTimeout(() => floatingStar.remove(), 1);
        }
      });

      parent.removeChild(textNode);
    });
  }

  // Observe dynamic content
  const observer = new MutationObserver(mutations => {
    mutations.forEach(m => {
      m.addedNodes.forEach(node => {
        if (node.nodeType === Node.TEXT_NODE) replaceStarsWithSVG(node.parentNode);
        else if (node.nodeType === Node.ELEMENT_NODE) replaceStarsWithSVG(node);
      });
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });

  // Initial run
  replaceStarsWithSVG();

});

document.addEventListener('DOMContentLoaded', () => {
  const smModal       = document.getElementById('sm-modal');
  const smOpenBtn     = document.getElementById('starMarketBtn');
  const smCloseBtn    = document.querySelector('.sm-close');
  const smListings    = document.getElementById('sm-listings-container');
  const smMyListings  = document.getElementById('sm-my-listings');
  const smUserStars   = document.getElementById('sm-user-stars');

  if (!smModal || !smOpenBtn) return;

  smOpenBtn.onclick = () => {
    smModal.style.display = 'flex';
    smUserStars.textContent = (currentUser?.stars || 0).toLocaleString();
    loadBuyTab();
    loadSellTab();
    switchToTab('buy');
  };

  smCloseBtn.onclick = () => smModal.style.display = 'none';
  smModal.onclick = e => { if (e.target === smModal) smModal.style.display = 'none'; };

  // Tab switching
  document.querySelectorAll('.sm-tab-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.sm-tab-btn').forEach(b => b.classList.remove('sm-active'));
      document.querySelectorAll('.sm-tab-content').forEach(c => c.classList.remove('sm-active'));
      btn.classList.add('sm-active');
      document.getElementById('sm-' + btn.dataset.tab + '-tab').classList.add('sm-active');
    };
  });

  function switchToTab(tab) {
    document.querySelector(`.sm-tab-btn[data-tab="${tab}"]`).click();
  }

  // BUY TAB
  async function loadBuyTab() {
    smListings.innerHTML = '<p class="sm-empty">Loading...</p>';
    try {
      const q = query(collection(db, "starListings"), where("status", "==", "active"), orderBy("createdAt", "desc"));
      const snap = await getDocs(q);
      smListings.innerHTML = '';

      let hasAny = false;
      snap.forEach(doc => {
        const d = doc.data();
        if (d.sellerId === currentUser?.uid) return;
        hasAny = true;

        const div = document.createElement('div');
        div.className = 'sm-listing';
        div.innerHTML = `
          <div>
            <strong>STRZ ${d.amount} for ‚Ç¶${d.price.toLocaleString()}</strong>
            <div class="seller">Seller: <strong>${d.sellerName || 'Anonymous'}</strong></div>
          </div>
          <button class="sm-buy-btn" data-id="${doc.id}" data-amt="${d.amount}" data-price="${d.price}">
            Buy Now
          </button>
        `;
        smListings.appendChild(div);
      });

      if (!hasAny) smListings.innerHTML = '<p class="sm-empty">No stars for sale right now</p>';

      // Buy buttons
      smListings.querySelectorAll('.sm-buy-btn').forEach(btn => {
        btn.onclick = () => {
          showNiceAlert(`Buy ${btn.dataset.amt} stars for ‚Ç¶${Number(btn.dataset.price).toLocaleString()}?`, {
            confirm: true,
            onConfirm: () => showNiceAlert("Purchase successful! (Real version soon) Star")
          });
        };
      });

    } catch (e) { console.error(e); smListings.innerHTML = '<p class="sm-empty">Error loading</p>'; }
  }

  // SELL TAB
  async function loadSellTab() {
    smMyListings.innerHTML = '';
    try {
      const q = query(collection(db, "starListings"), where("sellerId", "==", currentUser?.uid), where("status", "==", "active"));
      const snap = await getDocs(q);

      if (snap.empty) {
        smMyListings.innerHTML = '<p class="sm-empty">You have no active listings</p>';
        return;
      }

      snap.forEach(doc => {
        const d = doc.data();
        const div = document.createElement('div');
        div.className = 'sm-listing';
        div.innerHTML = `
          <div>
            <strong>STRZ ${d.amount} for ‚Ç¶${d.price.toLocaleString()}</strong>
            <div class="seller">Seller: <strong>You</strong></div>
          </div>
          <button class="sm-cancel-btn" data-id="${doc.id}">Cancel</button>
        `;
        smMyListings.appendChild(div);
      });

      smMyListings.querySelectorAll('.sm-cancel-btn').forEach(btn => {
        btn.onclick = () => {
          showNiceAlert("Cancel listing and get stars back?", {
            confirm: true,
            onConfirm: async () => {
              await deleteDoc(doc(db, "starListings", btn.dataset.id));
              showNiceAlert("Cancelled! Stars returned Star");
              loadSellTab(); loadBuyTab();
            }
          });
        };
      });

    } catch (e) { smMyListings.innerHTML = '<p class="sm-empty">Error</p>'; }
  }

  // LIST FOR SALE BUTTON
  document.getElementById('sm-list-btn')?.addEventListener('click', async () => {
    const amount = Number(document.getElementById('sm-sell-amount').value);
    const price = Number(document.getElementById('sm-sell-price').value);

    if (!amount || amount < 100 || amount % 100 !== 0) return showNiceAlert("Minimum 100 stars, multiples of 100 only");
    if (!price || price < 50) return showNiceAlert("Price too low");
    if ((currentUser?.stars || 0) < amount) return showNiceAlert("Not enough stars!");

    showNiceAlert(`List ${amount} stars for ‚Ç¶${price.toLocaleString()}?`, {
      confirm: true,
      onConfirm: async () => {
        // Real listing code here (same as before)
        showNiceAlert("Listed successfully! Star");
      }
    });
  });
});

/* ============================================================
   TAPMASTER ‚Äî FULLY WORKING, NO HANG, CLEAN VERSION
   ============================================================ */

// CONFIG
const PRIZE_PER_PLAYER = 5000;
const BID_COST = 50;

// ONE AND ONLY ‚Äî Lagos time round ID (used everywhere)
function getTodayRound() {
  const d = new Date();
  const lagos = new Date(d.getTime() + 60*60*1000); // UTC+1
  return "round_" + lagos.toISOString().split('T')[0];
}
const CURRENT_ROUND_ID = getTodayRound();

// CUSTOM ALERT (replaces browser alert)
function showNiceAlert(message) {
  document.getElementById('niceAlertMessage').textContent = message;
  document.getElementById('niceAlert').style.display = 'flex';

  return new Promise(resolve => {
    const close = () => {
      document.getElementById('niceAlert').style.display = 'none';
      resolve();
    };
    document.getElementById('niceAlertBtn').onclick = close;
    document.getElementById('niceAlert').onclick = e => {
      if (e.target === document.getElementById('niceAlert')) close();
    };
  });
}

/* ====================== MODALS ====================== */
document.getElementById('rulesBtn')?.addEventListener('click', e => {
  e.preventDefault(); e.stopPropagation();
  document.getElementById('rulesModal').style.display = 'flex';
});
document.getElementById('closeRulesBtn')?.addEventListener('click', () => {
  document.getElementById('rulesModal').style.display = 'none';
});
document.getElementById('rulesModal')?.addEventListener('click', e => {
  if (e.target === document.getElementById('rulesModal')) {
    document.getElementById('rulesModal').style.display = 'none';
  }
});

document.getElementById('bidBtn')?.addEventListener('click', e => {
  e.preventDefault(); e.stopPropagation();
  document.getElementById('bidModal').style.display = 'flex';
});
document.getElementById('closeBidBtn')?.addEventListener('click', () => {
  document.getElementById('bidModal').style.display = 'none';
});
document.getElementById('bidModal')?.addEventListener('click', e => {
  if (e.target === document.getElementById('bidModal')) {
    document.getElementById('bidModal').style.display = 'none';
  }
});

document.getElementById('confirmBidBtn')?.addEventListener('click', () => {
  document.getElementById('bidModal').style.display = 'none';
  document.getElementById('confirmBidModal').style.display = 'flex';
});
document.getElementById('finalCancelBtn')?.addEventListener('click', () => {
  document.getElementById('confirmBidModal').style.display = 'none';
});
document.getElementById('confirmBidModal')?.addEventListener('click', e => {
  if (e.target === document.getElementById('confirmBidModal')) {
    document.getElementById('confirmBidModal').style.display = 'none';
  }
});

  /* ====================== FINAL BID ====================== */
document.getElementById('finalConfirmBtn')?.addEventListener('click', async () => {
  const btn = document.getElementById('finalConfirmBtn');
  btn.disabled = true;

  // Show only spinner
  btn.innerHTML = '<span class="btn-spinner"></span>';

  try {
    if (!currentUser?.uid) {
      await showNiceAlert("You must be logged in");
      document.getElementById('confirmBidModal').style.display = 'none';
      return;
    }

    const check = await getDocs(query(
      collection(db, "bids"),
      where("uid", "==", currentUser.uid),
      where("roundId", "==", CURRENT_ROUND_ID)
    ));
    if (!check.empty) {
      await showNiceAlert("You already joined today's conquest!");
      document.getElementById('confirmBidModal').style.display = 'none';
      return;
    }

    const deduct = await tryDeductStarsForJoin(BID_COST);
    if (!deduct.ok) {
      await showNiceAlert("Not enough stars: " + (deduct.message || ""));
      btn.disabled = false;
      btn.textContent = "YES!";
      return;
    }

    await addDoc(collection(db, "bids"), {
      uid: currentUser.uid,
      username: currentUser.username || currentUser.displayName || "Anonymous",
      invitedBy: currentUser.invitedBy || null,
      roundId: CURRENT_ROUND_ID,
      starsBid: BID_COST,
      status: "active",
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp()
    });

    await showNiceAlert("You‚Äôre IN the war!\n50 Stars deducted. Get ready to tap!");
  } catch (err) {
    console.error(err);
    await showNiceAlert("Something went wrong. Try again.");
  } finally {
    btn.disabled = false;
    btn.textContent = "YES!";  // restore original text
    document.getElementById('confirmBidModal').style.display = 'none';
  }
});

/* ====================== DAILY BID ROYALE ‚Äî PERFECT SYNC, NO JUMP ON RELOAD ====================== */
let bidActive = false;

function startDailyBidEngine() {
  const timerEl   = document.getElementById('countdownTimer');
  const playersEl = document.getElementById('livePlayers');
  const prizeEl   = document.getElementById('livePrize');

  if (!timerEl || !playersEl || !prizeEl) {
    setTimeout(startDailyBidEngine, 500);
    return;
  }

  // TODAY'S ROUND (Lagos date)
  window.CURRENT_ROUND_ID = (() => {
    const d = new Date();
    const lagos = new Date(d.getTime() + 60*60*1000);
    return "round_" + lagos.toISOString().split('T')[0];
  })();

  let serverTimeOffset = 0;

  // Get REAL server time once (eliminates client clock drift)
  const getServerTime = async () => {
    try {
      const snap = await getDoc(doc(db, "server", "time"));
      if (snap.exists()) {
        const serverNow = snap.data().timestamp.toMillis();
        serverTimeOffset = serverNow - Date.now();
      }
    } catch (e) { /* fallback to local time if fails */ }
  };
  getServerTime();

  function getLagosNow() {
    return new Date(Date.now() + serverTimeOffset + 60*60*1000); // UTC+1
  }

  function updateCountdown() {
    const lagosNow = getLagosNow();
    const today = lagosNow.toISOString().split('T')[0];

    const bidStart = new Date(`${today}T00:33:00+01:00`).getTime();
    const bidEnd   = new Date(`${today}T23:59:00+01:00`).getTime();
    const now      = lagosNow.getTime();

    if (now >= bidStart && now < bidEnd + 60000) {
      bidActive = true;
      const diff = Math.max(0, Math.floor((bidEnd - now) / 1000));

      const h = String(Math.floor(diff / 3600)).padStart(2, '0');
      const m = String(Math.floor((diff % 3600) / 60)).padStart(2, '0');
      const s = String(diff % 60).padStart(2, '0');

      timerEl.textContent = `${h}:${m}:${s}`;
      timerEl.style.color = diff < 600 ? "#ff0066" : "#00ff88";
      timerEl.style.fontWeight = "900";

      // Declare winners exactly once
      if (diff === 0 && !timerEl.dataset.declared) {
        timerEl.dataset.declared = "true";
        declareWinnersAndReset();
      }

    } else if (now < bidStart) {
      bidActive = false;
      const diff = Math.floor((bidStart - now) / 1000);
      const h = String(Math.floor(diff / 3600)).padStart(2, '0');
      const m = String(Math.floor((diff % 3600) / 60)).padStart(2, '0');
      timerEl.textContent = `Starts in ${h}:${m}`;
      timerEl.style.color = "#888";
    } else {
      bidActive = false;
      timerEl.textContent = "Next bid 00:33";
      timerEl.style.color = "#666";
    }
  }

  // Live stats
  let unsub = null;
  function updateLiveStats() {
    if (unsub) unsub();
    if (bidActive) {
      const q = query(
        collection(db, "bids"),
        where("roundId", "==", window.CURRENT_ROUND_ID),
        where("status", "==", "active")
      );
      unsub = onSnapshot(q, snap => {
        const count = snap.size;
        playersEl.textContent = count;
        prizeEl.textContent = "‚Ç¶" + (count * 5000).toLocaleString();
      });
    } else {
      playersEl.textContent = "0";
      prizeEl.textContent = "‚Ç¶0";
    }
  }

  updateCountdown();
  updateLiveStats();
  setInterval(() => {
    updateCountdown();
    updateLiveStats();
  }, 1000);
}

// Keep your declare function
async function declareWinnersAndReset() {
  console.log("BID ENDED ‚Äî PAYING TOP 5 NOW");
  // Your payout code here
}

// Create this document once in Firestore (path: server/time)
if (!window.bidEngineStarted) {
  window.bidEngineStarted = true;
  startDailyBidEngine();
}

// ---------- AUDIO UNLOCK (required for mobile) ----------
let audioUnlocked = false;
function unlockAudio() {
  if (audioUnlocked) return;
  [tapSound, confettiSound, comboSound].forEach(s => {
    s.play().catch(() => {});
    s.pause();
    s.currentTime = 0;
  });
  audioUnlocked = true;
}

// Play any sound safely
function play(soundElement, volume = 1.0) {
  unlockAudio();
  soundElement.currentTime = 0;
  soundElement.volume = volume;
  soundElement.play().catch(() => {});
}
// ---------- ULTRA-RELIABLE UI CLICK SOUND (catches EVERY button) ----------
const uiClickSound = document.getElementById('uiClickSound');

document.body.addEventListener('click', function(e) {
  const clicked = e.target;

  // List every button/element that should trigger the UI sound
  const isUIButton = clicked.matches(`
    #startBtn, #confirmPlay, #cancelPlay,
    #shopBtn, #settingsBtn, #closeBtn, #backBtn,
    .menu-btn, .ui-btn, button, [onclick], .clickable
  `);

  // Exclude the main giant tap button so it keeps its own pop sound
  const isMainTapButton = clicked === tapButton || clicked.closest('#tapButton');

  if (isUIButton && !isMainTapButton) {
    unlockAudio();                  // same unlock function you already have
    uiClickSound.currentTime = 0;
    uiClickSound.volume = 0.6;
    uiClickSound.play().catch(() => {});
  }
}, true); // ‚Üê "true" = capture phase (catches clicks even on dynamically added buttons)
async function updateLiveBanner() {
  const bannerEl = document.getElementById("liveBannerText");
  if (!bannerEl) return;

  try {
    const key = getLeaderboardKey("daily");
    const snap = await getDocs(collection(db, "users"));
    const scores = [];

    snap.forEach(doc => {
      const d = doc.data();
      const taps = d.tapsDaily?.[key] || 0;
      if (taps > 0) {
        // THIS FIXES USERNAME ‚Äî uses real chatId or username, no more @Player
        const rawName = d.chatId || d.username || d.displayName || "Anon";
        const cleanName = rawName.replace(/^@/, '').trim(); // removes @ if exists
        scores.push({ name: cleanName || "Player", taps });
      }
    });

    scores.sort((a, b) => b.taps - a.taps);
    const top1 = scores[0];
    const top2 = scores[1];
    const top3 = scores[2];

    // RANDOM DOPE MESSAGES ‚Äî changes every refresh for maximum addiction
    const flexMessages = [
      `TODAY‚ÄôS POT ‚Ç¶4.82M ‚Äî GROWING LIVE`,
      `1ST WINS ‚Ç¶1.9M CASH ‚Äî NO CAP`,
      top1 ? `${top1.name.toUpperCase()} IS EATING WITH ${top1.taps.toLocaleString()} TAPS` : "NO ONE ON TOP YET",
      top2 ? `#2 ${top2.name} BREATHING DOWN NECK ‚Äî ${top2.taps.toLocaleString()} TAPS` : "",
      top3 ? `#3 ${top3.name} NOT PLAYING ‚Äî ${top3.taps.toLocaleString()}` : "",
      `‚Ç¶17.4M PAID OUT THIS MONTH ‚Äî REAL MONEY`,
      `LAST CASH OUT: 11 MINS AGO ‚Äî ‚Ç¶920K`,
      `TOP 10 CASHING ‚Ç¶500K‚Äì‚Ç¶1.9M DAILY`,
      `YOU‚ÄôRE ~1,200 TAPS FROM TOP-10 ‚Äî MOVE!`,
      `RESET IN ~6H ‚Äî CLOCK TICKING`,
      `SOMEONE JUST HIT 100K TAPS IN 8 MINS`,
      `WIZKID FC VS DAVIDO FC ‚Äî WAR IS ON`,
      `BURNA BOY GENG HOLDING #4 ‚Äî RESPECT`,
      `NEXT PAYOUT IN 5H 58M ‚Äî DON‚ÄôT SLEEP`,
      `‚Ç¶50K BONUS FOR TOP 50 ‚Äî EASY MONEY`,
      `JOIN THE TRENCH ‚Äî MILLIONS WAITING`,
      `TAP OR WATCH OTHERS CASH OUT`,
      `THIS IS NOT A GAME ‚Äî THIS IS WAR`,
    ];

    // Shuffle messages for fresh feel every time
    const shuffled = flexMessages.sort(() => Math.random() - 0.5);

    let html = "";
    shuffled.forEach((msg, i) => {
      if (!msg) return;
      const isFire = i < 5 || msg.includes("EATING") || msg.includes("CASH");
      html += `<span style="color:${isFire ? '#00FFA3' : '#FFD700'};font-weight:900;${isFire ? 'text-shadow:0 0 12px #00FFA3;' : ''}">${msg}</span>`;
      if (i < shuffled.length - 1) html += `<span style="color:#555;"> ‚Ä¢ </span>`;
    });

    // Duplicate twice for ultra-smooth loop
    bannerEl.innerHTML = html + html;

  } catch (err) {
    console.log("Banner failed (normal on first load)", err);
    bannerEl.innerHTML = 
      `<span style="color:#00FFA3;text-shadow:0 0 12px #00FFA3;">LIVE ‚Ä¢ ‚Ç¶4.8M POT ‚Ä¢ TOP 10 CASHING ‚Ä¢ WAR DON START</span>` +
      `<span style="color:#555;"> ‚Ä¢ </span>`;
  }
}

// UPDATE EVERY 40 SECONDS ‚Äî still super light
setInterval(updateLiveBanner, 40000);
updateLiveBanner(); // Run on load
</script>
</body>
</html>
